<% layout('layout/boilerplate.ejs') %>

<!-- Hero Section -->
<div class="hero-section">
    <div class="container-fluid">
        <div class="row align-items-center min-vh-50">
            <div class="col-lg-8 text-center text-lg-start">
                <h1 class="display-4 fw-bold text-white mb-3">
                    <i class="fas fa-bullseye me-3"></i>Your CO2 Reduction Goals
                </h1>
                <p class="lead text-white-50 mb-4">Track your progress towards a sustainable future</p>
                <div class="d-flex flex-wrap justify-content-center justify-content-lg-start gap-3">
                    <div class="stat-card">
                        <div class="stat-value"><%= goals.length %></div>
                        <div class="stat-label">Active Goals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value"><%= goals.filter(g => g.goalReached).length %></div>
                        <div class="stat-label">Goals Achieved</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value"><%= Math.round(goals.reduce((sum, g) => sum + g.progress, 0) / Math.max(goals.length, 1)) %>%</div>
                        <div class="stat-label">Avg Progress</div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <a href="/goals/set-goals" class="btn btn-light btn-lg shadow-lg">
                    <i class="fas fa-plus me-2"></i>Create New Goal
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Goals Grid -->
<div class="container my-5">
    <% if (goals && goals.length > 0) { %>
        <div class="row g-4">
            <% goals.forEach(goal => { %>
                <div class="col-lg-4 col-md-6">
                    <div class="goal-card">
                        <div class="goal-header">
                            <div class="goal-title-section">
                                <h4 class="goal-title">
                                    <a href="/goals/<%= goal._id %>" class="text-decoration-none text-white"><%= goal.title %></a>
                                </h4>
                                <div class="goal-status">
                                    <% if (goal.goalReached) { %>
                                        <span class="status-badge achieved">
                                            <i class="fas fa-trophy"></i> Achieved
                                        </span>
                                    <% } else if (goal.timeframeEnded) { %>
                                        <span class="status-badge expired">
                                            <i class="fas fa-times-circle"></i> Expired
                                        </span>
                                    <% } else { %>
                                        <span class="status-badge active">
                                            <i class="fas fa-clock"></i> Active
                                        </span>
                                    <% } %>
                                </div>
                            </div>
                        </div>

                        <div class="goal-body">
                            <!-- Progress Section -->
                            <div class="progress-section">
                                <div class="progress-ring-small" style="--progress: <%= goal.progress %>%">
                                    <div class="progress-ring-circle-small">
                                        <div class="progress-ring-inner-small">
                                            <span class="progress-percentage-small"><%= goal.progress %>%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="progress-info">
                                    <div class="progress-label">Progress</div>
                                    <div class="progress-stats">
                                        <span class="current-co2"><%= goal.totalCO2.toFixed(1) %> kg</span>
                                        <span class="separator">/</span>
                                        <span class="target-co2"><%= goal.reductionTarget %> kg</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Goal Details -->
                            <div class="goal-details">
                                <div class="detail-row">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span><%= goal.timeframe %></span>
                                </div>
                                <div class="detail-row">
                                    <i class="fas fa-clock"></i>
                                    <span>Ends <%= new Date(goal.endDate).toLocaleDateString() %></span>
                                </div>
                                <% if (goal.notes) { %>
                                    <div class="detail-row notes">
                                        <i class="fas fa-sticky-note"></i>
                                        <span><%= goal.notes %></span>
                                    </div>
                                <% } %>
                            </div>
                        </div>

                        <div class="goal-footer">
                            <div class="goal-actions">
                                <a href="/goals/<%= goal._id %>" class="btn btn-outline-light btn-sm">
                                    <i class="fas fa-eye me-1"></i>View
                                </a>
                                <a href="/goals/edit-goal/<%= goal._id %>" class="btn btn-outline-light btn-sm">
                                    <i class="fas fa-edit me-1"></i>Edit
                                </a>
                                <form action="/goals/<%= goal._id %>?_method=delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this goal?')">
                                    <button type="submit" class="btn btn-outline-danger btn-sm">
                                        <i class="fas fa-trash me-1"></i>Delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-leaf"></i>
            </div>
            <h3 class="empty-state-title">No Goals Set Yet</h3>
            <p class="empty-state-description">Start your journey towards sustainability by setting your first CO2 reduction goal.</p>
            <a href="/goals/set-goals" class="btn btn-success btn-lg">
                <i class="fas fa-plus me-2"></i>Create Your First Goal
            </a>
        </div>
    <% } %>
</div>